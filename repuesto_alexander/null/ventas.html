<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caja Registradora - D'uro Cell</title>
    <!-- Boxicons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
       * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            transition: transform 0.3s ease;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sidebar-header h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 3px;
        }

        .sidebar-menu {
            padding: 20px 0;
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: rgba(255, 255, 255, 0.8);
            padding-left: 30px;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: white;
        }

        .menu-item i {
            font-size: 1.3rem;
            margin-right: 15px;
            width: 25px;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .menu-item:hover i,
        .menu-item.active i {
            opacity: 1;
        }

        .menu-item span {
            font-size: 1rem;
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.1);
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .menu-toggle:hover {
            background: #ee5a24;
            transform: scale(1.05);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            padding: 20px;
            transition: margin-left 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .content-container {
            padding: 40px;
        }

        /* Estilos espec√≠ficos para la caja registradora */
        .sales-interface {
            display: block;
        }

        .sales-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .sales-header h1 {
            font-size: 2rem;
            color: #333;
            margin: 0;
        }

        .sales-header p {
            color: #666;
            margin: 0;
        }

        .sales-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .sales-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        .card-header h3 {
            font-size: 1.5rem;
            color: #333;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group {
            position: relative;
            display: flex;
        }

        .input-group .form-control {
            flex: 1;
        }

        .input-group-text {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
            font-weight: 600;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            white-space: nowrap;
            text-decoration: none;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-lg {
            padding: 15px 30px;
            font-size: 1.1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline:hover {
            background-color: #f8f9fa;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #ee5a24 0%, #ff6b6b 100%);
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .table th {
            text-align: left;
            padding: 12px 15px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid #e1e8ed;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #e1e8ed;
            vertical-align: middle;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            borderRadius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-success {
            background-color: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }

        .badge-warning {
            background-color: rgba(248, 150, 30, 0.1);
            color: #f8961e;
        }

        .badge-danger {
            background-color: rgba(247, 37, 133, 0.1);
            color: #f72585;
        }

        .total-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        .total-label {
            font-size: 1.2rem;
            color: #555;
        }

        .total-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .discount-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        .discount-label {
            font-size: 1rem;
            color: #555;
        }

        .discount-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: #f72585;
        }

        .final-total-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
        }

        .final-total-label {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        .final-total-value {
            font-size: 2rem;
            font-weight: 700;
            color: #764ba2;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #e1e8ed;
        }

        .client-search-results,
        .product-search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
        }

        .client-item,
        .product-item {
            padding: 12px 15px;
            border-bottom: 1px solid #e1e8ed;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .client-item:hover,
        .product-item:hover {
            background-color: #f8f9fa;
        }

        .client-item:last-child,
        .product-item:last-child {
            border-bottom: none;
        }

        .client-name,
        .product-name {
            font-weight: 600;
            color: #333;
        }

        .client-details,
        .product-details {
            font-size: 0.85rem;
            color: #888;
        }

        .product-price {
            font-weight: 600;
            color: #667eea;
        }

        .payment-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-type-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .payment-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .payment-type-btn:not(.active) {
            background-color: #f8f9fa;
            color: #555;
            border: 1px solid #e1e8ed;
        }

        .payment-type-btn:not(.active):hover {
            background-color: #e1e8ed;
        }

        .payment-method-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .payment-method-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .payment-method-btn:not(.active) {
            background-color: #f8f9fa;
            color: #555;
            border: 1px solid #e1e8ed;
        }

        .payment-method-btn:not(.active):hover {
            background-color: #e1e8ed;
        }

        .client-info {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .client-info.hidden {
            display: none;
        }

        .cash-info {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .cash-info.hidden {
            display: none;
        }

        .hidden {
            display: none;
        }

        .text-muted {
            color: #888;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body {
            margin-bottom: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Alert Modal Styles */
        .alert-modal .modal-content {
            max-width: 400px;
        }

        .alert-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
            color: #667eea;
        }

        .alert-icon.error {
            color: #ff6b6b;
        }

        .alert-icon.warning {
            color: #f8961e;
        }

        .alert-icon.success {
            color: #4cc9f0;
        }

        .alert-message {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Confirm Modal Styles */
        .confirm-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }

        .confirm-icon {
            font-size: 3rem;
            color: #ff6b6b;
            margin-bottom: 15px;
        }

        .confirm-message {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .confirm-buttons .btn {
            min-width: 100px;
        }

        /* Nuevos estilos para los campos de pago */
        .payment-fields {
            margin-bottom: 20px;
        }
        
        .payment-input-group {
            margin-bottom: 15px;
        }
        
        .payment-input-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .payment-input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .payment-input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .change-display {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4cc9f0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .change-label {
            color: #555;
        }
        
        .change-value {
            color: #4cc9f0;
        }
        
        .print-receipt-btn {
            margin-top: 15px;
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            width: 100%;
        }
        
        .print-receipt-btn:hover {
            background: linear-gradient(135deg, #4361ee 0%, #4cc9f0 100%);
        }

        /* Estilo para el bot√≥n Cerrar Caja */
        .close-register-btn {
            background: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
            color: white;
            box-shadow: 0 8px 20px rgba(247, 37, 133, 0.3);
        }

        .close-register-btn:hover {
            background: linear-gradient(135deg, #b5179e 0%, #f72585 100%);
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(247, 37, 133, 0.4);
        }

        /* Estilo para el campo de cliente m√°s grande */
        .client-input {
            padding: 15px;
            font-size: 1.1rem;
            height: 50px;
        }

        /* Nuevos estilos para campos de cr√©dito */
        .credit-fields {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #764ba2;
        }
        
        .credit-field-group {
            margin-bottom: 15px;
        }
        
        .credit-field-group label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .credit-field-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.3s ease;
        }
        
        .credit-field-group input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }
        
        .credit-summary {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 1px solid #e1e8ed;
        }
        
        .credit-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e1e8ed;
        }
        
        .credit-summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .credit-summary-label {
            font-weight: 600;
            color: #555;
        }
        
        .credit-summary-value {
            font-weight: 700;
            color: #764ba2;
        }
        
        .credit-profit {
            color: #4cc9f0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .content-container {
                padding: 20px;
            }

            .sales-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .sales-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .card {
                padding: 20px;
            }

            .modal-content {
                margin: 0 20px;
            }

            .modal-footer {
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .sales-header h1 {
                font-size: 1.8rem;
            }

            .card-header h3 {
                font-size: 1.3rem;
            }

            .final-total-value {
                font-size: 1.8rem;
            }
        }

        /* Mobile Small (menos de 400px) */
        @media (max-width: 400px) {
            .header {
                padding: 20px;
            }

            .content-container {
                padding: 15px;
            }

            .card {
                padding: 15px;
            }

            .payment-type-selector,
            .payment-method-selector {
                flex-direction: column;
            }

            .payment-type-btn,
            .payment-method-btn {
                width: 100%;
            }

            .form-control,
            .client-input {
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .btn-lg {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .table th,
            .table td {
                padding: 10px;
                font-size: 0.85rem;
            }

            .total-value {
                font-size: 1.5rem;
            }

            .final-total-value {
                font-size: 1.6rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .alert-message {
                font-size: 1rem;
            }

            .confirm-buttons {
                flex-direction: column;
            }

            .confirm-buttons .btn {
                width: 100%;
            }
        }

        /* Desktop specific styles */
        @media (min-width: 769px) {
            .sidebar {
                position: fixed;
                transform: translateX(0);
                height: 100vh;
            }

            .main-content {
                margin-left: 280px;
                min-height: 100vh;
            }

            .menu-toggle {
                display: none;
            }

            .sidebar-overlay {
                display: none !important;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 300px;
                height: 100vh;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 10px;
                min-height: 100vh;
            }

            .menu-toggle {
                display: block;
            }

            body.sidebar-open {
                overflow: hidden;
            }
        }

        /* Scrollbar personalizado */
        .sidebar::-webkit-scrollbar,
        .client-search-results::-webkit-scrollbar,
        .product-search-results::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track,
        .client-search-results::-webkit-scrollbar-track,
        .product-search-results::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar::-webkit-scrollbar-thumb,
        .client-search-results::-webkit-scrollbar-thumb,
        .product-search-results::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover,
        .client-search-results::-webkit-scrollbar-thumb:hover,
        .product-search-results::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Estilo adicional para campos de cr√©dito */
        .credit-summary-item.highlight {
            background-color: rgba(118, 75, 162, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" onclick="toggleSidebar()">
        <i class='bx bx-menu'></i>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>
                <i class='bx bx-mobile-alt'></i>
                DEREJSOFT
            </h2>
            <p>Usuario: {{ user.username }}</p>
            <p>{{ user.email }}</p>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="menu-item">
                <i class='bx bx-home-alt'></i>
                <span>Inicio</span>
            </a>
            <a href="{% url 'ventas' %}" class="menu-item active">
                <i class='bx bx-package'></i>
                <span>facturacion</span>
            </a>
            <a href="{% url 'registrodecliente'  %}" class="menu-item">
                <i class='bx bx-dollar-circle'></i>
                <span>Registrar Cliente</span>
            </a>
            <a href="{% url 'listadecliente' %}" class="menu-item">
                <i class='bx bx-user-plus'></i>
                <span>Clientes</span>
            </a>
            <a href="{% url 'entrada'  %}" class="menu-item">
                <i class='bx bx-shopping-bag'></i>
                <span>Entrada mercancia</span>
            </a>
            <a href="{% url 'cuentaporcobrar'  %}" class="menu-item">
                <i class='bx bx-shopping-bag'></i>
                <span>Cuenta por Cobrar</span>
            </a>
            <a href="{% url 'inventario'  %}" class="menu-item">
                <i class='bx bx-credit-card'></i>
                <span>Inventario</span>
            </a>
            <a href="{% url 'registrosuplidores'  %}" class="menu-item">
                <i class='bx bx-bar-chart-alt-2'></i>
                <span>Registrar Suplidores</span>
            </a>
            <a href="{% url 'gestiondesuplidores'  %}" class="menu-item">
                <i class='bx bx-trending-up'></i>
                <span>Suplidores</span>
            </a>
            <a href="{% url 'reavastecer'  %}" class="menu-item">
                <i class='bx bx-store'></i>
                <span>Ajuste Inventario</span>
            </a>
            <a href="{% url 'dashboard'  %}" class="menu-item">
                <i class='bx bx-cog'></i>
                <span>Dashboard</span>
            </a>
            <a href="{% url 'index'  %}" class="menu-item">
                <i class='bx bx-log-out'></i>
                <span>Cerrar Sesi√≥n</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <p>Derejsoft v 1.2.2</p>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <div class="header">
                <h1>
                    <i class='bx bx-dollar-circle'></i>
                    Caja Registradora De Ventas
                </h1>
                <p>Gestiona tus ventas de forma r√°pida y eficiente</p>
            </div>
            <div class="content-container">
                <!-- Interfaz Principal de Ventas -->
                <div id="sales-interface" class="sales-interface">
                    <header class="sales-header">
                        <div>
                            <h1>Nueva Venta</h1>
                            <p class="text-muted">Agregue productos y complete la transacci√≥n</p>
                        </div>
                        <button id="close-register-button" class="btn btn-danger close-register-btn">
                            <i class='bx bx-lock-alt'></i>
                            Cerrar Caja
                        </button>
                    </header>

                    <div class="sales-grid">
                        <!-- B√∫squeda de Productos -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Buscar Productos</h3>
                            </div>
                            <div class="form-group">
                                <label for="product-search" class="form-label">Buscar Producto</label>
                                <input type="text" id="product-search" class="form-control" placeholder="Nombre o c√≥digo del producto">
                            </div>
                            <div class="product-search-results" id="product-results">
                                <!-- Los resultados se cargar√°n din√°micamente via AJAX -->
                                <div class="empty-search-state" style="padding: 15px; text-align: center; color: #888;">
                                    <p style="margin: 0; font-size: 2rem;"><i class='bx bx-search-alt'></i></p>
                                    <p style="margin: 5px 0;">Busque productos por nombre o c√≥digo</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="product-quantity" class="form-label">Cantidad</label>
                                <input type="number" id="product-quantity" class="form-control" value="1" min="1">
                            </div>
                            <button id="add-product-button" class="btn btn-primary">
                                <i class='bx bx-plus'></i>
                                Agregar Producto
                            </button>
                        </div>

                        <!-- Resumen de Venta con Selecci√≥n de Tipo -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Resumen de Venta</h3>
                            </div>
                            
                            <!-- Selector de Tipo de Pago -->
                            <div class="form-group">
                                <label class="form-label">Tipo de Venta</label>
                                <div class="payment-type-selector">
                                    <div id="cash-payment-btn" class="payment-type-btn active">Contado</div>
                                    <div id="credit-payment-btn" class="payment-type-btn">Cr√©dito</div>
                                </div>
                            </div>
                            
                            <!-- Informaci√≥n del Cliente (solo para cr√©dito) -->
                            <div id="client-info-container" class="client-info hidden">
                                <div class="form-group">
                                    <label for="client-search" class="form-label">Cliente</label>
                                    <input type="text" id="client-search" class="form-control client-input" placeholder="Buscar cliente...">
                                </div>
                                <div class="client-search-results" id="client-results">
                                    <!-- Resultados de b√∫squeda de clientes -->
                                    {% for cliente in clientes %}
                                    <div class="client-item" data-id="{{ cliente.id }}" data-name="{{ cliente.full_name }}" data-document="{{ cliente.identification_number }}" data-phone="{{ cliente.primary_phone }}" data-credit-limit="{{ cliente.credit_limit }}">
                                        <div>
                                            <div class="client-name">{{ cliente.full_name }}</div>
                                            <div class="client-details">Tel: {{ cliente.primary_phone }} | Doc: {{ cliente.identification_number }}</div>
                                            <div class="client-details">L√≠mite: RD${{ cliente.credit_limit }}</div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                
                                <!-- Campos de cr√©dito (solo para cr√©dito) -->
                                <div id="credit-fields" class="payment-fields">
                                    <div class="payment-input-group">
                                        <label for="monto-inicial">Monto Inicial:</label>
                                        <input type="number" id="monto-inicial" step="0.01" min="0" placeholder="0.00" class="form-control">
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="tasa-interes">Tasa de Inter√©s (% mensual):</label>
                                        <input type="number" id="tasa-interes" step="0.01" min="0" placeholder="0.00" class="form-control">
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="plazo-meses">Plazo (meses):</label>
                                        <input type="number" id="plazo-meses" step="1" min="1" placeholder="0" class="form-control">
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="monto-financiado">Monto a Financiar:</label>
                                        <input type="number" id="monto-financiado" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="interes-mensual">Inter√©s Mensual:</label>
                                        <input type="number" id="interes-mensual" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="cuota-mensual">Cuota Mensual:</label>
                                        <input type="number" id="cuota-mensual" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="ganancia-interes">Ganancia por Inter√©s:</label>
                                        <input type="number" id="ganancia-interes" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="total-con-interes">Total con Inter√©s:</label>
                                        <input type="number" id="total-con-interes" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                    
                                    <div class="payment-input-group">
                                        <label for="total-a-pagar">Total a Pagar:</label>
                                        <input type="number" id="total-a-pagar" step="0.01" min="0" placeholder="0.00" class="form-control" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Informaci√≥n del Cliente (solo para contado) -->
                            <div id="cash-info-container" class="cash-info">
                                <div class="form-group">
                                    <label for="cash-client-name" class="form-label">Nombre del Cliente</label>
                                    <input type="text" id="cash-client-name" class="form-control client-input" placeholder="Nombre completo">
                                </div>
                                <div class="form-group">
                                    <label for="cash-client-document" class="form-label">C√©dula/RIF</label>
                                    <input type="text" id="cash-client-document" class="form-control client-input" placeholder="C√©dula o RIF">
                                </div>
                                
                                <!-- M√©todo de pago (solo para contado) -->
                                <div class="form-group">
                                    <label class="form-label">M√©todo de Pago</label>
                                    <div class="payment-method-selector">
                                        <div id="cash-method-btn" class="payment-method-btn active">Efectivo</div>
                                        <div id="card-method-btn" class="payment-method-btn">Tarjeta</div>
                                        <div id="transfer-method-btn" class="payment-method-btn">Transferencia</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Total de la Venta -->
                            <div class="total-display">
                                <span class="total-label">Subtotal</span>
                                <span id="total-amount" class="total-value">RD$0.00</span>
                            </div>
                            
                            <!-- Descuento en dinero (no porcentaje) -->
                            <div class="form-group">
                                <label for="discount-input" class="form-label">Descuento (RD$)</label>
                                <div class="input-group">
                                    <span class="input-group-text">RD$</span>
                                    <input type="number" id="discount-input" class="form-control" placeholder="0.00" step="0.01" min="0">
                                </div>
                            </div>
                            
                            <!-- Mostrar descuento aplicado y total final -->
                            <div class="discount-display">
                                <span class="discount-label">Descuento aplicado</span>
                                <span id="discount-amount" class="discount-value">RD$0.00</span>
                            </div>
                            
                            <div class="final-total-display">
                                <span class="final-total-label">Total a Pagar</span>
                                <span id="final-total-amount" class="final-total-value">RD$0.00</span>
                            </div>
                            
                            <!-- Campos para pago en efectivo -->
                            <div id="cash-payment-fields" class="payment-fields">
                                <div class="payment-input-group">
                                    <label for="cash-received">Dinero recibido:</label>
                                    <input type="number" id="cash-received" step="0.01" min="0" placeholder="0.00" class="form-control">
                                </div>
                                
                                <div class="change-display">
                                    <span class="change-label">Cambio:</span>
                                    <span id="change-amount" class="change-value">RD$0.00</span>
                                </div>
                            </div>
                            
                            <button id="complete-sale-button" class="btn btn-primary btn-lg">
                                <i class='bx bx-check'></i>
                                Finalizar Venta
                            </button>
                        </div>
                    </div>

                    <!-- Lista de Productos Agregados -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Productos en la Venta</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unitario</th>
                                    <th>Subtotal</th>
                                    <th style="text-align: right;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="sale-items">
                                <tr>
                                    <td colspan="5" class="empty-state">
                                        <div class="empty-state-icon">üõí</div>
                                        <p>No hay productos agregados</p>
                                        <p class="text-muted">Busque y agregue productos a la venta</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n para Cerrar Caja -->
    <div id="close-register-modal" class="modal-overlay">
        <div class="modal-content confirm-modal">
            <div class="modal-body">
                <div class="confirm-icon">
                    <i class='bx bx-question-mark'></i>
                </div>
                <div class="confirm-message">
                    ¬øEst√°s seguro que deseas salir del √°rea de ventas?
                </div>
                <div class="confirm-buttons">
                    <button id="cancel-close-register" class="btn btn-outline">No</button>
                    <button id="confirm-close-register" class="btn btn-danger">S√≠</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Alerta Gen√©rico -->
    <div id="alert-modal" class="modal-overlay">
        <div class="modal-content alert-modal">
            <div class="modal-body">
                <div id="alert-icon" class="alert-icon">
                    <i class='bx bx-info-circle'></i>
                </div>
                <div id="alert-message" class="alert-message">
                    Mensaje de alerta aqu√≠
                </div>
            </div>
            <div class="modal-footer">
                <button id="alert-ok-button" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Formulario para enviar datos al servidor -->
    <form id="sale-form" method="POST" action="{% url 'procesar_venta' %}" style="display: none;">
        {% csrf_token %}
        <input type="hidden" name="payment_type" id="payment-type">
        <input type="hidden" name="payment_method" id="payment-method">
        <input type="hidden" name="client_id" id="client-id">
        <input type="hidden" name="client_name" id="client-name">
        <input type="hidden" name="client_document" id="client-document">
        <input type="hidden" name="subtotal" id="subtotal">
        <input type="hidden" name="discount_percentage" id="discount-percentage">
        <input type="hidden" name="discount_amount" id="discount-amount">
        <input type="hidden" name="total" id="total">
        <input type="hidden" name="cash_received" id="cash-received-field">
        <input type="hidden" name="change_amount" id="change-amount-field">
        <input type="hidden" name="sale_items" id="sale-items-field">
        <!-- Campos de financiamiento -->
        <input type="hidden" name="monto_inicial" id="monto-inicial-field">
        <input type="hidden" name="tasa_interes" id="tasa-interes-field">
        <input type="hidden" name="plazo_meses" id="plazo-meses-field">
        <input type="hidden" name="monto_financiado" id="monto-financiado-field">
        <input type="hidden" name="interes_mensual" id="interes-mensual-field">
        <input type="hidden" name="cuota_mensual" id="cuota-mensual-field">
        <input type="hidden" name="ganancia_interes" id="ganancia-interes-field">
        <input type="hidden" name="total_con_interes" id="total-con-interes-field">
        <input type="hidden" name="total_a_pagar" id="total-a-pagar-field">
    </form>

    <script>
        // Funciones para el sidebar
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.sidebar-overlay').classList.toggle('active');
            document.body.classList.toggle('sidebar-open');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.querySelector('.sidebar-overlay').classList.remove('active');
            document.body.classList.remove('sidebar-open');
        }

        // Funci√≥n para manejar valores decimales de forma segura
        const safeDecimal = (value) => {
            if (value === null || value === undefined || value === '') {
                return '0';
            }
            // Convertir a n√∫mero y luego a string para evitar problemas de formato
            const num = parseFloat(value);
            return isNaN(num) ? '0' : num.toString();
        };

        document.addEventListener("DOMContentLoaded", () => {
            // Estado de la aplicaci√≥n
            const state = {
                paymentType: 'contado', // 'contado' o 'credito'
                paymentMethod: 'efectivo', // 'efectivo', 'tarjeta', 'transferencia'
                selectedClient: null,
                selectedProduct: null,
                saleItems: [],
                totalSales: 0,
                discountAmount: 0,
                finalTotal: 0,
                cashReceived: 0,
                changeAmount: 0,
                // Campos de financiamiento
                montoInicial: 0,
                tasaInteres: 0,
                plazoMeses: 0,
                montoFinanciado: 0,
                interesMensual: 0,
                cuotaMensual: 0,
                gananciaInteres: 0,
                totalConInteres: 0,
                totalAPagar: 0
            };

            // Elementos del DOM
            const DOM = {
                salesInterface: document.getElementById('sales-interface'),
                cashPaymentBtn: document.getElementById('cash-payment-btn'),
                creditPaymentBtn: document.getElementById('credit-payment-btn'),
                clientInfoContainer: document.getElementById('client-info-container'),
                clientSearch: document.getElementById('client-search'),
                clientResults: document.getElementById('client-results'),
                cashInfoContainer: document.getElementById('cash-info-container'),
                cashClientName: document.getElementById('cash-client-name'),
                cashClientDocument: document.getElementById('cash-client-document'),
                cashMethodBtn: document.getElementById('cash-method-btn'),
                cardMethodBtn: document.getElementById('card-method-btn'),
                transferMethodBtn: document.getElementById('transfer-method-btn'),
                productSearch: document.getElementById('product-search'),
                productResults: document.getElementById('product-results'),
                productQuantity: document.getElementById('product-quantity'),
                addProductButton: document.getElementById('add-product-button'),
                saleItemsTable: document.getElementById('sale-items'),
                totalAmount: document.getElementById('total-amount'),
                discountInput: document.getElementById('discount-input'),
                discountAmountDisplay: document.getElementById('discount-amount'),
                finalTotalAmount: document.getElementById('final-total-amount'),
                completeSaleButton: document.getElementById('complete-sale-button'),
                cashPaymentFields: document.getElementById('cash-payment-fields'),
                cashReceivedInput: document.getElementById('cash-received'),
                changeAmountDisplay: document.getElementById('change-amount'),
                closeRegisterButton: document.getElementById('close-register-button'),
                closeRegisterModal: document.getElementById('close-register-modal'),
                cancelCloseRegister: document.getElementById('cancel-close-register'),
                confirmCloseRegister: document.getElementById('confirm-close-register'),
                alertModal: document.getElementById('alert-modal'),
                alertIcon: document.getElementById('alert-icon'),
                alertMessage: document.getElementById('alert-message'),
                alertOkButton: document.getElementById('alert-ok-button'),
                saleForm: document.getElementById('sale-form'),
                paymentTypeField: document.getElementById('payment-type'),
                paymentMethodField: document.getElementById('payment-method'),
                clientIdField: document.getElementById('client-id'),
                clientNameField: document.getElementById('client-name'),
                clientDocumentField: document.getElementById('client-document'),
                subtotalField: document.getElementById('subtotal'),
                discountPercentageField: document.getElementById('discount-percentage'),
                discountAmountField: document.getElementById('discount-amount'),
                totalField: document.getElementById('total'),
                cashReceivedField: document.getElementById('cash-received-field'),
                changeAmountField: document.getElementById('change-amount-field'),
                saleItemsField: document.getElementById('sale-items-field'),
                // Campos de financiamiento
                montoInicialInput: document.getElementById('monto-inicial'),
                tasaInteresInput: document.getElementById('tasa-interes'),
                plazoMesesInput: document.getElementById('plazo-meses'),
                montoFinanciadoInput: document.getElementById('monto-financiado'),
                interesMensualInput: document.getElementById('interes-mensual'),
                cuotaMensualInput: document.getElementById('cuota-mensual'),
                gananciaInteresInput: document.getElementById('ganancia-interes'),
                totalConInteresInput: document.getElementById('total-con-interes'),
                totalAPagarInput: document.getElementById('total-a-pagar'),
                montoInicialField: document.getElementById('monto-inicial-field'),
                tasaInteresField: document.getElementById('tasa-interes-field'),
                plazoMesesField: document.getElementById('plazo-meses-field'),
                montoFinanciadoField: document.getElementById('monto-financiado-field'),
                interesMensualField: document.getElementById('interes-mensual-field'),
                cuotaMensualField: document.getElementById('cuota-mensual-field'),
                gananciaInteresField: document.getElementById('ganancia-interes-field'),
                totalConInteresField: document.getElementById('total-con-interes-field'),
                totalAPagarField: document.getElementById('total-a-pagar-field')
            };

            // Formatear moneda en pesos dominicanos
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('es-DO', {
                    style: 'currency',
                    currency: 'DOP',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount).replace('DOP', 'RD$');
            };

            // Mostrar alerta personalizada
            const showAlert = (message, type = 'info') => {
                let iconClass = 'bx-info-circle';
                let alertClass = '';
                
                if (type === 'error') {
                    iconClass = 'bx-error';
                    alertClass = 'error';
                } else if (type === 'warning') {
                    iconClass = 'bx-error-circle';
                    alertClass = 'warning';
                } else if (type === 'success') {
                    iconClass = 'bx-check-circle';
                    alertClass = 'success';
                }
                
                DOM.alertIcon.innerHTML = `<i class='bx ${iconClass}'></i>`;
                DOM.alertIcon.className = `alert-icon ${alertClass}`;
                DOM.alertMessage.textContent = message;
                
                DOM.alertModal.classList.add('active');
            };

            // Cerrar alerta personalizada
            const closeAlert = () => {
                DOM.alertModal.classList.remove('active');
            };

            // Funci√≥n para buscar productos via AJAX
            const searchProducts = async (searchTerm) => {
                if (searchTerm.length < 2) {
                    DOM.productResults.innerHTML = `
                        <div class="empty-search-state" style="padding: 15px; text-align: center; color: #888;">
                            <p style="margin: 0; font-size: 2rem;"><i class='bx bx-search-alt'></i></p>
                            <p style="margin: 5px 0;">Ingrese al menos 2 caracteres</p>
                        </div>
                    `;
                    return;
                }

                try {
                    // Mostrar indicador de carga
                    DOM.productResults.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #888;">
                            <i class='bx bx-loader bx-spin' style="font-size: 2rem;"></i>
                            <p>Buscando productos...</p>
                        </div>
                    `;

                    // Hacer la petici√≥n AJAX
                    const response = await fetch(`/buscar-productos/?q=${encodeURIComponent(searchTerm)}`);
                    
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    
                    const data = await response.json();

                    if (data.success && data.productos && data.productos.length > 0) {
                        // Mostrar resultados
                        let html = '';
                        data.productos.forEach(producto => {
                            html += `
                                <div class="product-item" data-id="${producto.id}" data-name="${producto.nombre}" 
                                     data-price="${producto.precio}" data-stock="${producto.stock}">
                                    <div>
                                        <div class="product-name">${producto.nombre}</div>
                                        <div class="product-details">C√≥digo: ${producto.codigo} | Stock: ${producto.stock}</div>
                                    </div>
                                    <div class="product-price">${formatCurrency(producto.precio)}</div>
                                </div>
                            `;
                        });
                        DOM.productResults.innerHTML = html;
                    } else {
                        // Mostrar mensaje de no resultados
                        DOM.productResults.innerHTML = `
                            <div class="empty-search-state" style="padding: 15px; text-align: center; color: #888;">
                                <p style="margin: 0; font-size: 2rem;"><i class='bx bx-search-alt'></i></p>
                                <p style="margin: 5px 0;">No se encontraron productos</p>
                                <p style="margin: 0; font-size: 0.9rem; opacity: 0.7;">Buscar: "${searchTerm}"</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error en b√∫squeda:', error);
                    DOM.productResults.innerHTML = `
                        <div class="empty-search-state" style="padding: 15px; text-align: center; color: #f72585;">
                            <p style="margin: 0; font-size: 2rem;"><i class='bx bx-error'></i></p>
                            <p style="margin: 5px 0;">Error al buscar productos</p>
                            <p style="margin: 0; font-size: 0.8rem;">Intente nuevamente</p>
                        </div>
                    `;
                }
            };

            // Funci√≥n debounce para evitar muchas peticiones
            const debounce = (func, wait) => {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            };

            // B√∫squeda de productos con debounce
            const debouncedSearch = debounce(searchProducts, 300);

            // Renderizar resultados de b√∫squeda de clientes
            const renderClientResults = (searchTerm = '') => {
                const allClients = Array.from(DOM.clientResults.querySelectorAll('.client-item'));
                
                if (!searchTerm.trim()) {
                    allClients.forEach(client => client.style.display = 'block');
                    const emptyState = DOM.clientResults.querySelector('.empty-search-state');
                    if (emptyState) emptyState.remove();
                    return;
                }
                
                let hasResults = false;
                
                allClients.forEach(client => {
                    const clientName = (client.getAttribute('data-name') || '').toLowerCase();
                    const clientDocument = (client.getAttribute('data-document') || '').toLowerCase();
                    const clientPhone = (client.getAttribute('data-phone') || '').toLowerCase();
                    const search = searchTerm.toLowerCase();
                    
                    if (clientName.includes(search) || clientDocument.includes(search) || clientPhone.includes(search)) {
                        client.style.display = 'block';
                        hasResults = true;
                    } else {
                        client.style.display = 'none';
                    }
                });
                
                const existingEmptyState = DOM.clientResults.querySelector('.empty-search-state');
                if (existingEmptyState) existingEmptyState.remove();
                
                if (!hasResults) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.className = 'empty-search-state';
                    emptyDiv.style.cssText = 'padding: 15px; text-align: center; color: #888;';
                    emptyDiv.innerHTML = `
                        <p><i class='bx bx-search'></i></p>
                        <p>No se encontraron clientes con "${searchTerm}"</p>
                    `;
                    DOM.clientResults.appendChild(emptyDiv);
                }
            };

            // Renderizar items de la venta
            const renderSaleItems = () => {
                DOM.saleItemsTable.innerHTML = '';
                
                if (state.saleItems.length === 0) {
                    DOM.saleItemsTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-state-icon">üõí</div>
                                <p>No hay productos agregados</p>
                                <p class="text-muted">Busque y agregue productos a la venta</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                state.saleItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${formatCurrency(item.price)}</td>
                        <td>${formatCurrency(item.subtotal)}</td>
                        <td style="text-align: right;">
                            <button class="btn btn-icon btn-outline btn-sm delete-item" data-id="${item.id}">
                                <i class='bx bx-trash'></i>
                            </button>
                        </td>
                    `;
                    DOM.saleItemsTable.appendChild(row);
                });
                
                document.querySelectorAll('.delete-item').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const itemId = e.target.closest('button').dataset.id;
                        const item = state.saleItems.find(item => item.id === itemId);
                        state.saleItems = state.saleItems.filter(item => item.id !== itemId);
                        updateTotal();
                        renderSaleItems();
                        if (item) {
                            showAlert(`Producto eliminado: ${item.name}`, 'success');
                        }
                    });
                });
            };

            // Actualizar total de la venta
            const updateTotal = () => {
                state.totalSales = state.saleItems.reduce((total, item) => total + item.subtotal, 0);
                DOM.totalAmount.textContent = formatCurrency(state.totalSales);
                updateDiscount();
            };

            // Actualizar descuento y total final
            const updateDiscount = () => {
                const discountInput = parseFloat(DOM.discountInput.value) || 0;
                state.discountAmount = Math.max(0, Math.min(discountInput, state.totalSales));
                state.finalTotal = Math.max(0, state.totalSales - state.discountAmount);
                
                DOM.discountAmountDisplay.textContent = formatCurrency(state.discountAmount);
                
                // Si es cr√©dito y hay financiamiento, usar el total con inter√©s
                if (state.paymentType === 'credito' && state.totalConInteres > 0) {
                    DOM.finalTotalAmount.textContent = formatCurrency(state.totalConInteres);
                } else {
                    DOM.finalTotalAmount.textContent = formatCurrency(state.finalTotal);
                }
                
                if (state.paymentType === 'contado') {
                    calculateChange();
                }
                
                // Actualizar campos de financiamiento si es cr√©dito
                if (state.paymentType === 'credito') {
                    updateFinanciamiento();
                }
            };

            // Actualizar campos de financiamiento
            const updateFinanciamiento = () => {
                if (state.paymentType !== 'credito') return;
                
                // Calcular monto a financiar
                state.montoFinanciado = Math.max(0, state.finalTotal - state.montoInicial);
                DOM.montoFinanciadoInput.value = state.montoFinanciado.toFixed(2);
                
                // Calcular inter√©s mensual
                state.interesMensual = state.montoFinanciado * (state.tasaInteres / 100);
                DOM.interesMensualInput.value = state.interesMensual.toFixed(2);
                
                // Calcular cuota mensual
                if (state.plazoMeses > 0) {
                    state.cuotaMensual = (state.montoFinanciado + state.interesMensual * state.plazoMeses) / state.plazoMeses;
                    DOM.cuotaMensualInput.value = state.cuotaMensual.toFixed(2);
                } else {
                    state.cuotaMensual = 0;
                    DOM.cuotaMensualInput.value = '0.00';
                }
                
                // Calcular ganancia por inter√©s
                state.gananciaInteres = state.interesMensual * state.plazoMeses;
                DOM.gananciaInteresInput.value = state.gananciaInteres.toFixed(2);
                
                // Calcular total con inter√©s
                state.totalConInteres = state.finalTotal + state.gananciaInteres;
                DOM.totalConInteresInput.value = state.totalConInteres.toFixed(2);
                
                // El total a pagar es el total con inter√©s
                state.totalAPagar = state.totalConInteres;
                DOM.totalAPagarInput.value = state.totalAPagar.toFixed(2);
                
                // Actualizar el total final que se muestra
                DOM.finalTotalAmount.textContent = formatCurrency(state.totalAPagar);
            };

            // Cambiar tipo de pago
            const setPaymentType = (type) => {
                // Mapear a los valores que espera el backend
                state.paymentType = type === 'cash' ? 'contado' : 'credito';
                
                if (type === 'cash') {
                    DOM.cashPaymentBtn.classList.add('active');
                    DOM.creditPaymentBtn.classList.remove('active');
                    DOM.clientInfoContainer.classList.add('hidden');
                    DOM.cashInfoContainer.classList.remove('hidden');
                    DOM.cashPaymentFields.style.display = 'block';
                    state.selectedClient = null;
                    
                    document.querySelectorAll('.client-item').forEach(item => {
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    });
                    
                    // Limpiar informaci√≥n del cliente
                    const clientInfoDisplay = document.querySelector('.client-info-display');
                    if (clientInfoDisplay) clientInfoDisplay.remove();
                    
                    // Actualizar total final
                    DOM.finalTotalAmount.textContent = formatCurrency(state.finalTotal);
                } else {
                    DOM.cashPaymentBtn.classList.remove('active');
                    DOM.creditPaymentBtn.classList.add('active');
                    DOM.clientInfoContainer.classList.remove('hidden');
                    DOM.cashInfoContainer.classList.add('hidden');
                    DOM.cashPaymentFields.style.display = 'none';
                    DOM.clientSearch.value = '';
                    renderClientResults();
                    
                    // Actualizar total final seg√∫n financiamiento
                    if (state.totalConInteres > 0) {
                        DOM.finalTotalAmount.textContent = formatCurrency(state.totalConInteres);
                    } else {
                        DOM.finalTotalAmount.textContent = formatCurrency(state.finalTotal);
                    }
                }
            };

            // Cambiar m√©todo de pago
            const setPaymentMethod = (method) => {
                // Mapear a los valores que espera el backend
                const methodMap = {
                    'cash': 'efectivo',
                    'card': 'tarjeta', 
                    'transfer': 'transferencia'
                };
                
                state.paymentMethod = methodMap[method] || 'efectivo';
                
                DOM.cashMethodBtn.classList.remove('active');
                DOM.cardMethodBtn.classList.remove('active');
                DOM.transferMethodBtn.classList.remove('active');
                
                if (method === 'cash') {
                    DOM.cashMethodBtn.classList.add('active');
                } else if (method === 'card') {
                    DOM.cardMethodBtn.classList.add('active');
                } else if (method === 'transfer') {
                    DOM.transferMethodBtn.classList.add('active');
                }
            };

            // Funci√≥n para calcular el cambio
            const calculateChange = () => {
                if (state.paymentType === 'contado' && state.paymentMethod === 'efectivo') {
                    const cashReceived = parseFloat(DOM.cashReceivedInput.value) || 0;
                    state.cashReceived = cashReceived;
                    state.changeAmount = Math.max(0, cashReceived - state.finalTotal);
                    DOM.changeAmountDisplay.textContent = formatCurrency(state.changeAmount);
                    
                    if (cashReceived < state.finalTotal) {
                        DOM.changeAmountDisplay.style.color = '#f72585';
                    } else {
                        DOM.changeAmountDisplay.style.color = '#4cc9f0';
                    }
                }
            };

            // Funci√≥n para limpiar la b√∫squeda de productos
            const clearProductSearch = () => {
                DOM.productSearch.value = '';
                state.selectedProduct = null;
                DOM.productQuantity.value = '1';
                DOM.productResults.innerHTML = `
                    <div class="empty-search-state" style="padding: 15px; text-align: center; color: #888;">
                        <p style="margin: 0; font-size: 2rem;"><i class='bx bx-search-alt'></i></p>
                        <p style="margin: 5px 0;">Busque productos por nombre o c√≥digo</p>
                    </div>
                `;
                
                document.querySelectorAll('.product-item').forEach(item => {
                    item.style.backgroundColor = '';
                    item.style.borderLeft = '';
                });
            };

            // Funci√≥n para validar l√≠mite de cr√©dito
            const validarLimiteCredito = () => {
                if (state.paymentType === 'credito' && state.selectedClient) {
                    const limiteCredito = state.selectedClient.credit_limit;
                    const totalAVerificar = state.totalConInteres > 0 ? state.totalConInteres : state.finalTotal;
                    
                    if (totalAVerificar > limiteCredito) {
                        showAlert(
                            `‚ö†Ô∏è L√≠mite de cr√©dito excedido\n` +
                            `L√≠mite del cliente: ${formatCurrency(limiteCredito)}\n` +
                            `Total de la venta: ${formatCurrency(totalAVerificar)}\n` +
                            `Excedente: ${formatCurrency(totalAVerificar - limiteCredito)}`,
                            'error'
                        );
                        return false;
                    }
                }
                return true;
            };

            // Funci√≥n para mostrar informaci√≥n del cliente seleccionado
            const mostrarInfoCliente = () => {
                // Remover info anterior si existe
                const oldInfo = document.querySelector('.client-info-display');
                if (oldInfo) oldInfo.remove();
                
                if (state.selectedClient) {
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'client-info-display';
                    infoDiv.style.cssText = `
                        padding: 12px;
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        border-radius: 10px;
                        margin-top: 15px;
                        border-left: 4px solid #667eea;
                        font-size: 0.9rem;
                        line-height: 1.4;
                    `;
                    
                    const totalAVerificar = state.totalConInteres > 0 ? state.totalConInteres : state.finalTotal;
                    const saldoDisponible = state.selectedClient.credit_limit - totalAVerificar;
                    const claseSaldo = saldoDisponible < 0 ? 'credit-limit-danger' : 'credit-limit-warning';
                    
                    infoDiv.innerHTML = `
                        <strong>Cliente seleccionado:</strong> ${state.selectedClient.full_name}<br>
                        <strong>L√≠mite de cr√©dito:</strong> ${formatCurrency(state.selectedClient.credit_limit)}<br>
                        <strong>Saldo disponible:</strong> <span class="${claseSaldo}">${formatCurrency(saldoDisponible)}</span>
                    `;
                    
                    DOM.clientInfoContainer.appendChild(infoDiv);
                }
            };

            // Funci√≥n para procesar la venta con AJAX
            const procesarVenta = async () => {
                if (state.saleItems.length === 0) {
                    showAlert('Debe agregar al menos un producto a la venta', 'error');
                    return;
                }
                
                if (state.paymentType === 'credito' && !state.selectedClient) {
                    showAlert('Debe seleccionar un cliente para ventas a cr√©dito', 'error');
                    return;
                }
                
                if (state.paymentType === 'credito' && !validarLimiteCredito()) {
                    return; // Detener si excede el l√≠mite de cr√©dito
                }
                
                if (state.paymentType === 'contado' && !DOM.cashClientName.value.trim()) {
                    showAlert('Debe ingresar el nombre del cliente para ventas al contado', 'error');
                    return;
                }
                
                if (state.paymentType === 'contado' && state.paymentMethod === 'efectivo') {
                    if (state.cashReceived < state.finalTotal) {
                        showAlert(`El monto recibido (${formatCurrency(state.cashReceived)}) es menor que el total a pagar (${formatCurrency(state.finalTotal)})`, 'error');
                        return;
                    }
                }
                
                try {
                    // Mostrar indicador de carga
                    DOM.completeSaleButton.innerHTML = '<i class="bx bx-loader bx-spin"></i> Procesando...';
                    DOM.completeSaleButton.disabled = true;
                    
                    // Crear FormData para enviar los datos
                    const formData = new FormData();
                    formData.append('payment_type', state.paymentType);
                    formData.append('payment_method', state.paymentMethod);
                    formData.append('client_id', state.selectedClient ? state.selectedClient.id : '');
                    formData.append('client_name', state.paymentType === 'contado' ? DOM.cashClientName.value.trim() : (state.selectedClient ? state.selectedClient.full_name : ''));
                    formData.append('client_document', state.paymentType === 'contado' ? DOM.cashClientDocument.value.trim() : (state.selectedClient ? state.selectedClient.document : ''));
                    formData.append('subtotal', safeDecimal(state.totalSales));
                    formData.append('discount_percentage', '0'); // Ya no usamos porcentaje
                    formData.append('discount_amount', safeDecimal(state.discountAmount));
                    
                    // Usar el total con inter√©s si es cr√©dito y hay financiamiento
                    const totalFinal = state.paymentType === 'credito' && state.totalConInteres > 0 ? state.totalConInteres : state.finalTotal;
                    formData.append('total', safeDecimal(totalFinal));
                    
                    formData.append('cash_received', safeDecimal(state.cashReceived));
                    formData.append('change_amount', safeDecimal(state.changeAmount));
                    
                    // Campos de financiamiento
                    formData.append('monto_inicial', safeDecimal(state.montoInicial));
                    formData.append('tasa_interes', safeDecimal(state.tasaInteres));
                    formData.append('plazo_meses', state.plazoMeses.toString());
                    formData.append('monto_financiado', safeDecimal(state.montoFinanciado));
                    formData.append('interes_mensual', safeDecimal(state.interesMensual));
                    formData.append('cuota_mensual', safeDecimal(state.cuotaMensual));
                    formData.append('ganancia_interes', safeDecimal(state.gananciaInteres));
                    formData.append('total_con_interes', safeDecimal(state.totalConInteres));
                    formData.append('total_a_pagar', safeDecimal(state.totalAPagar));
                    
                    // Preparar items para enviar
                    const saleItemsForServer = state.saleItems.map(item => ({
                        id: item.productId,
                        name: item.name,
                        price: safeDecimal(item.price),
                        quantity: parseInt(item.quantity) || 1,
                        subtotal: safeDecimal(item.subtotal)
                    }));
                    
                    formData.append('sale_items', JSON.stringify(saleItemsForServer));
                    
                    // Obtener el token CSRF
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                    
                    // Enviar datos al servidor
                    const response = await fetch("{% url 'procesar_venta' %}", {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': csrfToken,
                        },
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        let mensaje = 'Venta procesada correctamente';
                        
                        // Mensaje adicional para ventas a cr√©dito
                        if (state.paymentType === 'credito') {
                            mensaje += '\n‚úÖ Cuenta por cobrar creada autom√°ticamente';
                        }
                        
                        showAlert(mensaje, 'success');
                        
                        // Limpiar la venta actual
                        state.saleItems = [];
                        updateTotal();
                        renderSaleItems();
                        clearProductSearch();
                        
                        // Limpiar campos de cliente
                        if (state.paymentType === 'contado') {
                            DOM.cashClientName.value = '';
                            DOM.cashClientDocument.value = '';
                        } else {
                            DOM.clientSearch.value = '';
                            state.selectedClient = null;
                            document.querySelectorAll('.client-item').forEach(item => {
                                item.style.backgroundColor = '';
                                item.style.borderLeft = '';
                            });
                        }
                        
                        // Limpiar campos de pago
                        DOM.cashReceivedInput.value = '';
                        DOM.changeAmountDisplay.textContent = formatCurrency(0);
                        
                        // Limpiar campos de financiamiento
                        DOM.montoInicialInput.value = '';
                        DOM.tasaInteresInput.value = '';
                        DOM.plazoMesesInput.value = '';
                        DOM.montoFinanciadoInput.value = '';
                        DOM.interesMensualInput.value = '';
                        DOM.cuotaMensualInput.value = '';
                        DOM.gananciaInteresInput.value = '';
                        DOM.totalConInteresInput.value = '';
                        DOM.totalAPagarInput.value = '';
                        
                        // Redirigir a comprobante despu√©s de 2 segundos
                        setTimeout(() => {
                            if (result.venta_id) {
                                window.location.href = `/comprobante-venta/${result.venta_id}/`;
                            }
                        }, 2000);
                    } else {
                        showAlert(result.message, 'error');
                    }
                    
                } catch (error) {
                    console.error('Error al procesar la venta:', error);
                    showAlert('Error al procesar la venta. Intente nuevamente.', 'error');
                } finally {
                    // Restaurar bot√≥n
                    DOM.completeSaleButton.innerHTML = '<i class="bx bx-check"></i> Finalizar Venta';
                    DOM.completeSaleButton.disabled = false;
                }
            };

            // EVENTOS DEL DOM

            DOM.cashPaymentBtn.addEventListener('click', () => setPaymentType('cash'));
            DOM.creditPaymentBtn.addEventListener('click', () => setPaymentType('credit'));
            DOM.cashMethodBtn.addEventListener('click', () => setPaymentMethod('cash'));
            DOM.cardMethodBtn.addEventListener('click', () => setPaymentMethod('card'));
            DOM.transferMethodBtn.addEventListener('click', () => setPaymentMethod('transfer'));

            DOM.discountInput.addEventListener('input', updateDiscount);
            DOM.cashReceivedInput.addEventListener('input', calculateChange);

            // Eventos para campos de financiamiento
            DOM.montoInicialInput.addEventListener('input', (e) => {
                state.montoInicial = parseFloat(e.target.value) || 0;
                updateFinanciamiento();
            });

            DOM.tasaInteresInput.addEventListener('input', (e) => {
                state.tasaInteres = parseFloat(e.target.value) || 0;
                updateFinanciamiento();
            });

            DOM.plazoMesesInput.addEventListener('input', (e) => {
                state.plazoMeses = parseInt(e.target.value) || 0;
                updateFinanciamiento();
            });

            DOM.clientSearch.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                renderClientResults(searchTerm);
                
                if (searchTerm && state.selectedClient) {
                    state.selectedClient = null;
                    document.querySelectorAll('.client-item').forEach(item => {
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    });
                    
                    // Limpiar informaci√≥n del cliente
                    const clientInfoDisplay = document.querySelector('.client-info-display');
                    if (clientInfoDisplay) clientInfoDisplay.remove();
                }
            });

            // Evento de b√∫squeda de productos
            DOM.productSearch.addEventListener('input', (e) => {
                const searchTerm = e.target.value.trim();
                
                // Limpiar selecci√≥n si cambia la b√∫squeda
                if (searchTerm && state.selectedProduct && state.selectedProduct.name !== searchTerm) {
                    state.selectedProduct = null;
                    document.querySelectorAll('.product-item').forEach(item => {
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    });
                }
                
                // Usar debounce para la b√∫squeda AJAX
                debouncedSearch(searchTerm);
            });

            // Evento de selecci√≥n de cliente
            document.addEventListener('click', (e) => {
                if (e.target.closest('.client-item')) {
                    const clientItem = e.target.closest('.client-item');
                    
                    document.querySelectorAll('.client-item').forEach(item => {
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    });
                    
                    clientItem.style.backgroundColor = '#f8f9fa';
                    clientItem.style.borderLeft = '4px solid #667eea';
                    
                    state.selectedClient = {
                        id: clientItem.dataset.id,
                        full_name: clientItem.dataset.name,
                        document: clientItem.dataset.document,
                        phone: clientItem.dataset.phone,
                        credit_limit: parseFloat(clientItem.dataset.creditLimit) || 0
                    };
                    
                    DOM.clientSearch.value = state.selectedClient.full_name;
                    
                    // Mostrar informaci√≥n del cliente
                    mostrarInfoCliente();
                    
                    // Validar l√≠mite de cr√©dito autom√°ticamente
                    if (state.paymentType === 'credito') {
                        validarLimiteCredito();
                    }
                }
            });

            // Evento de selecci√≥n de producto (usar delegaci√≥n de eventos)
            DOM.productResults.addEventListener('click', (e) => {
                const productItem = e.target.closest('.product-item');
                if (productItem) {
                    document.querySelectorAll('.product-item').forEach(item => {
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    });
                    
                    productItem.style.backgroundColor = '#f8f9fa';
                    productItem.style.borderLeft = '4px solid #667eea';
                    
                    state.selectedProduct = {
                        id: productItem.dataset.id,
                        name: productItem.dataset.name,
                        price: parseFloat(productItem.dataset.price) || 0,
                        stock: parseInt(productItem.dataset.stock) || 0
                    };
                    
                    DOM.productSearch.value = state.selectedProduct.name;
                    DOM.productQuantity.focus(); // Enfocar el campo de cantidad
                }
            });

            // Evento agregar producto
            DOM.addProductButton.addEventListener('click', () => {
                if (!state.selectedProduct) {
                    showAlert('Por favor seleccione un producto de la lista', 'error');
                    return;
                }
                
                const quantity = parseInt(DOM.productQuantity.value);
                
                if (isNaN(quantity) || quantity <= 0) {
                    showAlert('Por favor ingrese una cantidad v√°lida mayor a 0', 'error');
                    return;
                }
                
                if (quantity > state.selectedProduct.stock) {
                    showAlert(`Stock insuficiente. Disponible: ${state.selectedProduct.stock}`, 'error');
                    return;
                }
                
                const existingItemIndex = state.saleItems.findIndex(item => item.productId === state.selectedProduct.id);
                
                if (existingItemIndex >= 0) {
                    const existingItem = state.saleItems[existingItemIndex];
                    const newQuantity = existingItem.quantity + quantity;
                    
                    if (newQuantity > state.selectedProduct.stock) {
                        showAlert(`Stock insuficiente. Ya tiene ${existingItem.quantity} en la venta. Disponible: ${state.selectedProduct.stock}`, 'error');
                        return;
                    }
                    
                    existingItem.quantity = newQuantity;
                    existingItem.subtotal = existingItem.quantity * existingItem.price;
                    
                    showAlert(`Cantidad actualizada: ${existingItem.name} x${existingItem.quantity}`, 'success');
                } else {
                    state.saleItems.push({
                        id: Date.now().toString(),
                        productId: state.selectedProduct.id,
                        name: state.selectedProduct.name,
                        price: state.selectedProduct.price,
                        quantity: quantity,
                        subtotal: quantity * state.selectedProduct.price
                    });
                    
                    showAlert(`Producto agregado: ${state.selectedProduct.name} x${quantity}`, 'success');
                }
                
                clearProductSearch();
                updateTotal();
                renderSaleItems();
                
                // Actualizar informaci√≥n del cliente si es cr√©dito
                if (state.paymentType === 'credito' && state.selectedClient) {
                    mostrarInfoCliente();
                    validarLimiteCredito();
                }
            });

            // Evento para cerrar caja
            DOM.closeRegisterButton.addEventListener('click', () => {
                DOM.closeRegisterModal.classList.add('active');
            });

            DOM.cancelCloseRegister.addEventListener('click', () => {
                DOM.closeRegisterModal.classList.remove('active');
            });

            DOM.confirmCloseRegister.addEventListener('click', () => {
                window.location.href = "{% url 'cierredecaja' %}";
            });

            // Evento para completar venta
            DOM.completeSaleButton.addEventListener('click', procesarVenta);

            // Evento para cerrar alerta
            DOM.alertOkButton.addEventListener('click', closeAlert);

            // Inicializar la interfaz
            setPaymentType('cash'); // Esto se mapear√° a 'contado'
            setPaymentMethod('cash'); // Esto se mapear√° a 'efectivo'
            updateTotal();
            renderSaleItems();
        });
    </script>
</body>
</html>