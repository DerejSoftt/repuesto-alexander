<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Cuadre de Caja - Super Bestia</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0;
            color: #666;
        }
        .empresa-info {
            text-align: center;
            margin-bottom: 20px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-card {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
        }
        .info-card h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        .info-row:nth-child(even) {
            background-color: #f9f9f9;
        }
        .total-row {
            font-weight: bold;
            border-top: 2px solid #333;
            margin-top: 10px;
            padding-top: 10px;
        }
        .diferencia {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .diferencia.positiva {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .diferencia.negativa {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .diferencia.exacta {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .observaciones {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .firmas {
            margin-top: 50px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .firma {
            text-align: center;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo h2 {
            color: #ee5a24;
            margin: 0;
        }
        @media print {
            body {
                padding: 10px;
            }
            .no-print {
                display: none;
            }
            .info-grid {
                page-break-inside: avoid;
            }
        }
        .estado-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .estado-cerrada {
            background-color: #28a745;
            color: white;
        }
        .estado-abierta {
            background-color: #ffc107;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="logo">
        <h2>Super Bestia</h2>
        <p>Sistema de Gestión Comercial</p>
    </div>

    <div class="header">
        <h1>REPORTE DE CUADRE DE CAJA</h1>
        <p>Fecha de generación: {% now "d/m/Y H:i" %}</p>
    </div>

    <div class="empresa-info">
        <p><strong>Super Bestia - Motorcycles & Accessories</strong></p>
        <p>Reporte de Cierre de Caja</p>
    </div>

    <div class="info-grid">
        <div class="info-card">
            <h3>Información del Cuadre</h3>
            <div class="info-row">
                <span>Número de Cuadre:</span>
                <span><strong>#{{ cuadre.id }}</strong></span>
            </div>
            <div class="info-row">
                <span>Fecha de Cierre:</span>
                <span><strong>{{ cuadre.fecha_cierre|date:"d/m/Y H:i" }}</strong></span>
            </div>
            <div class="info-row">
                <span>Usuario:</span>
                <span><strong>{{ caja.usuario.username }}</strong></span>
            </div>
            <div class="info-row">
                <span>Estado:</span>
                <span>
                    <span class="estado-badge {% if caja.estado == 'cerrada' %}estado-cerrada{% else %}estado-abierta{% endif %}">
                        {{ caja.estado|upper }}
                    </span>
                </span>
            </div>
        </div>

        <div class="info-card">
            <h3>Información de la Caja</h3>
            <div class="info-row">
                <span>Fecha Apertura:</span>
                <span>{{ caja.fecha_apertura|date:"d/m/Y H:i" }}</span>
            </div>
            <div class="info-row">
                <span>Monto Inicial:</span>
                <span><strong>RD$ {{ caja.monto_inicial|floatformat:2 }}</strong></span>
            </div>
            <div class="info-row">
                <span>Monto Final:</span>
                <span><strong>RD$ {{ caja.monto_final|default:"0.00" }}</strong></span>
            </div>
        </div>
    </div>

    <div class="info-grid">
        <div class="info-card">
            <h3>Totales Reales</h3>
            <div class="info-row">
                <span>Efectivo Real:</span>
                <span><strong>RD$ {{ cuadre.monto_efectivo_real|floatformat:2 }}</strong></span>
            </div>
            <div class="info-row">
                <span>Tarjeta Real:</span>
                <span><strong>RD$ {{ cuadre.monto_tarjeta_real|floatformat:2 }}</strong></span>
            </div>
            <div class="info-row total-row">
                <span>Total Real:</span>
                <span><strong>RD$ {{ cuadre.monto_efectivo_real|add:cuadre.monto_tarjeta_real|floatformat:2 }}</strong></span>
            </div>
        </div>

        <div class="info-card">
            <h3>Totales Esperados</h3>
            <div class="info-row">
                <span>Total Esperado:</span>
                <span><strong>RD$ {{ cuadre.total_esperado|floatformat:2 }}</strong></span>
            </div>
            <div class="info-row">
                <span>Monto Inicial:</span>
                <span>RD$ {{ caja.monto_inicial|floatformat:2 }}</span>
            </div>
            <div class="info-row total-row">
                <span>Ventas Netas:</span>
                <span><strong>RD$ {{ cuadre.total_esperado|floatformat:2 }}</strong></span>
            </div>
        </div>
    </div>

    {% with diferencia=cuadre.diferencia %}
    <div class="diferencia {% if diferencia > 0 %}positiva{% elif diferencia < 0 %}negativa{% else %}exacta{% endif %}">
        DIFERENCIA: RD$ {{ diferencia|floatformat:2 }}
        {% if diferencia > 0 %}
            (SOBRANTE)
        {% elif diferencia < 0 %}
            (FALTANTE)
        {% else %}
            (EXACTO)
        {% endif %}
    </div>
    {% endwith %}

    {% if cuadre.observaciones %}
    <div class="observaciones">
        <h3>Observaciones:</h3>
        <p>{{ cuadre.observaciones }}</p>
    </div>
    {% endif %}

    <div class="firmas">
        <div class="firma">
            <p>_________________________</p>
            <p><strong>{{ caja.usuario.get_full_name|default:caja.usuario.username }}</strong></p>
            <p>Cajero</p>
        </div>
        <div class="firma">
            <p>_________________________</p>
            <p><strong>Supervisión</strong></p>
            <p>Autorizado por</p>
        </div>
    </div>

    <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #666;">
        <p>Reporte generado automáticamente por el Sistema Super Bestia</p>
        <p>{% now "d/m/Y H:i" %}</p>
    </div>

    <script>
        // Auto-imprimir al cargar la página
        window.onload = function() {
            window.print();
        };
    </script>
</body>
</html>